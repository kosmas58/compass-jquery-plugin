(function(b){function t(){b.fn.ajaxSubmit.debug&&window.console&&window.console.log&&window.console.log("[jquery.form] "+Array.prototype.join.call(arguments,""))}b.fn.ajaxSubmit=function(a){function e(){function o(){if(!z++){p.detachEvent?p.detachEvent("onload",o):p.removeEventListener("load",o,false);var r=true;try{if(A)throw"timeout";var n,m;m=p.contentWindow?p.contentWindow.document:p.contentDocument?p.contentDocument:p.document;var u=i.dataType=="xml"||m.XMLDocument||b.isXMLDoc(m);t("isXml="+
u);if(!u&&(m.body==null||m.body.innerHTML=="")){if(--E){z=0;setTimeout(o,100);return}t("Could not access iframe DOM after 50 tries.");return}j.responseText=m.body?m.body.innerHTML:null;j.responseXML=m.XMLDocument?m.XMLDocument:m;j.getResponseHeader=function(F){return{"content-type":i.dataType}[F]};if(i.dataType=="json"||i.dataType=="script"){var B=m.getElementsByTagName("textarea")[0];if(B)j.responseText=B.value;else{var C=m.getElementsByTagName("pre")[0];if(C)j.responseText=C.innerHTML}}else if(i.dataType==
"xml"&&!j.responseXML&&j.responseText!=null)j.responseXML=x(j.responseText);n=b.httpData(j,i.dataType)}catch(G){r=false;b.handleError(i,j,"error",G)}if(r){i.success(n,"success");v&&b.event.trigger("ajaxSuccess",[j,i])}v&&b.event.trigger("ajaxComplete",[j,i]);v&&!--b.active&&b.event.trigger("ajaxStop");if(i.complete)i.complete(j,r?"success":"error");setTimeout(function(){w.remove();j.responseXML=null},100)}}function x(r,n){if(window.ActiveXObject){n=new ActiveXObject("Microsoft.XMLDOM");n.async="false";
n.loadXML(r)}else n=(new DOMParser).parseFromString(r,"text/xml");return n&&n.documentElement&&n.documentElement.tagName!="parsererror"?n:null}var k=h[0];if(b(":input[name=submit]",k).length)alert('Error: Form elements must not be named "submit".');else{var i=b.extend({},b.ajaxSettings,a),s=b.extend(true,{},b.extend(true,{},b.ajaxSettings),i),y="jqFormIO"+(new Date).getTime(),w=b('<iframe id="'+y+'" name="'+y+'" src="'+i.iframeSrc+'" />'),p=w[0];w.css({position:"absolute",top:"-1000px",left:"-1000px"});
var j={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;w.attr("src",i.iframeSrc)}},v=i.global;v&&!b.active++&&b.event.trigger("ajaxStart");v&&b.event.trigger("ajaxSend",[j,i]);if(s.beforeSend&&s.beforeSend(j,s)===false)s.global&&b.active--;else if(!j.aborted){var z=0,A=0;if(s=k.clk){var D=s.name;if(D&&!s.disabled){a.extraData=a.extraData||{};a.extraData[D]=
s.value;if(s.type=="image"){a.extraData[name+".x"]=k.clk_x;a.extraData[name+".y"]=k.clk_y}}}setTimeout(function(){var r=h.attr("target"),n=h.attr("action");k.setAttribute("target",y);k.getAttribute("method")!="POST"&&k.setAttribute("method","POST");k.getAttribute("action")!=i.url&&k.setAttribute("action",i.url);a.skipEncodingOverride||h.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});i.timeout&&setTimeout(function(){A=true;o()},i.timeout);var m=[];try{if(a.extraData)for(var u in a.extraData)m.push(b('<input type="hidden" name="'+
u+'" value="'+a.extraData[u]+'" />').appendTo(k)[0]);w.appendTo("body");p.attachEvent?p.attachEvent("onload",o):p.addEventListener("load",o,false);k.submit()}finally{k.setAttribute("action",n);r?k.setAttribute("target",r):h.removeAttr("target");b(m).remove()}},10);var E=50}}}if(!this.length){t("ajaxSubmit: skipping submit process - no element selected");return this}if(typeof a=="function")a={success:a};var c=b.trim(this.attr("action"));if(c)c=(c.match(/^([^#]+)/)||[])[1];c=c||window.location.href||
"";a=b.extend({url:c,type:this.attr("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},a||{});c={};this.trigger("form-pre-serialize",[this,a,c]);if(c.veto){t("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(a.beforeSerialize&&a.beforeSerialize(this,a)===false){t("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var f=this.formToArray(a.semantic);if(a.data){a.extraData=a.data;for(var d in a.data)if(a.data[d]instanceof
Array)for(var l in a.data[d])f.push({name:d,value:a.data[d][l]});else f.push({name:d,value:a.data[d]})}if(a.beforeSubmit&&a.beforeSubmit(f,this,a)===false){t("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[f,this,a,c]);if(c.veto){t("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}d=b.param(f);if(a.type.toUpperCase()=="GET"){a.url+=(a.url.indexOf("?")>=0?"&":"?")+d;a.data=null}else a.data=d;var h=this,g=[];a.resetForm&&
g.push(function(){h.resetForm()});a.clearForm&&g.push(function(){h.clearForm()});if(!a.dataType&&a.target){var q=a.success||function(){};g.push(function(o){b(a.target).html(o).each(q,arguments)})}else a.success&&g.push(a.success);a.success=function(o,x){for(var k=0,i=g.length;k<i;k++)g[k].apply(a,[o,x,h])};d=b("input:file",this).fieldValue();l=false;for(c=0;c<d.length;c++)if(d[c])l=true;if(d.length&&a.iframe!==false||a.iframe||l||0)a.closeKeepAlive?b.get(a.closeKeepAlive,e):e();else b.ajax(a);this.trigger("form-submit-notify",
[this,a]);return this};b.fn.ajaxForm=function(a){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){b(this).ajaxSubmit(a);return false}).bind("click.form-plugin",function(e){var c=e.target,f=b(c);if(!f.is(":submit,input:image")){c=f.closest(":submit");if(c.length==0)return;c=c[0]}var d=this;d.clk=c;if(c.type=="image")if(e.offsetX!=undefined){d.clk_x=e.offsetX;d.clk_y=e.offsetY}else if(typeof b.fn.offset=="function"){f=f.offset();d.clk_x=e.pageX-f.left;d.clk_y=e.pageY-f.top}else{d.clk_x=
e.pageX-c.offsetLeft;d.clk_y=e.pageY-c.offsetTop}setTimeout(function(){d.clk=d.clk_x=d.clk_y=null},100)})};b.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};b.fn.formToArray=function(a){var e=[];if(this.length==0)return e;var c=this[0],f=a?c.getElementsByTagName("*"):c.elements;if(!f)return e;for(var d=0,l=f.length;d<l;d++){var h=f[d],g=h.name;if(g)if(a&&c.clk&&h.type=="image"){if(!h.disabled&&c.clk==h){e.push({name:g,value:b(h).val()});e.push({name:g+".x",
value:c.clk_x},{name:g+".y",value:c.clk_y})}}else if((h=b.fieldValue(h,true))&&h.constructor==Array)for(var q=0,o=h.length;q<o;q++)e.push({name:g,value:h[q]});else h!==null&&typeof h!="undefined"&&e.push({name:g,value:h})}if(!a&&c.clk){a=b(c.clk);f=a[0];if((g=f.name)&&!f.disabled&&f.type=="image"){e.push({name:g,value:a.val()});e.push({name:g+".x",value:c.clk_x},{name:g+".y",value:c.clk_y})}}return e};b.fn.formSerialize=function(a){return b.param(this.formToArray(a))};b.fn.fieldSerialize=function(a){var e=
[];this.each(function(){var c=this.name;if(c){var f=b.fieldValue(this,a);if(f&&f.constructor==Array)for(var d=0,l=f.length;d<l;d++)e.push({name:c,value:f[d]});else f!==null&&typeof f!="undefined"&&e.push({name:this.name,value:f})}});return b.param(e)};b.fn.fieldValue=function(a){for(var e=[],c=0,f=this.length;c<f;c++){var d=b.fieldValue(this[c],a);d===null||typeof d=="undefined"||d.constructor==Array&&!d.length||(d.constructor==Array?b.merge(e,d):e.push(d))}return e};b.fieldValue=function(a,e){var c=
a.name,f=a.type,d=a.tagName.toLowerCase();if(typeof e=="undefined")e=true;if(e&&(!c||a.disabled||f=="reset"||f=="button"||(f=="checkbox"||f=="radio")&&!a.checked||(f=="submit"||f=="image")&&a.form&&a.form.clk!=a||d=="select"&&a.selectedIndex==-1))return null;if(d=="select"){var l=a.selectedIndex;if(l<0)return null;c=[];d=a.options;var h=(f=f=="select-one")?l+1:d.length;for(l=f?l:0;l<h;l++){var g=d[l];if(g.selected){var q=g.value;q||(q=g.attributes&&g.attributes.value&&!g.attributes.value.specified?
g.text:g.value);if(f)return q;c.push(q)}}return c}return a.value};b.fn.clearForm=function(){return this.each(function(){b("input,select,textarea",this).clearFields()})};b.fn.clearFields=b.fn.clearInputs=function(){return this.each(function(){var a=this.type,e=this.tagName.toLowerCase();if(a=="text"||a=="password"||e=="textarea")this.value="";else if(a=="checkbox"||a=="radio")this.checked=false;else if(e=="select")this.selectedIndex=-1})};b.fn.resetForm=function(){return this.each(function(){if(typeof this.reset==
"function"||typeof this.reset=="object"&&!this.reset.nodeType)this.reset()})};b.fn.enable=function(a){if(a==undefined)a=true;return this.each(function(){this.disabled=!a})};b.fn.selected=function(a){if(a==undefined)a=true;return this.each(function(){var e=this.type;if(e=="checkbox"||e=="radio")this.checked=a;else if(this.tagName.toLowerCase()=="option"){e=b(this).parent("select");a&&e[0]&&e[0].type=="select-one"&&e.find("option").selected(false);this.selected=a}})}})(jQuery);
