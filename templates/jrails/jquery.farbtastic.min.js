jQuery.fn.farbtastic=function(g){$.farbtastic(this,g);return this};jQuery.farbtastic=function(g,l){g=$(g).get(0);return g.farbtastic||(g.farbtastic=new jQuery._farbtastic(g,l))};
jQuery._farbtastic=function(g,l){var b=this;$(g).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var k=$(".farbtastic",g);b.wheel=$(".wheel",g).get(0);b.radius=84;b.square=100;b.width=194;navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",k).each(function(){if(this.currentStyle.backgroundImage!="none"){var a=this.currentStyle.backgroundImage;a=this.currentStyle.backgroundImage.substring(5,
a.length-2);$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+a+"')"})}});b.linkTo=function(a){typeof b.callback=="object"&&$(b.callback).unbind("keyup",b.updateValue);b.color=null;if(typeof a=="function")b.callback=a;else if(typeof a=="object"||typeof a=="string"){b.callback=$(a);b.callback.bind("keyup",b.updateValue);b.callback.get(0).value&&b.setColor(b.callback.get(0).value)}return this};b.updateValue=function(){this.value&&
this.value!=b.color&&b.setColor(this.value)};b.setColor=function(a){var c=b.unpack(a);if(b.color!=a&&c){b.color=a;b.rgb=c;b.hsl=b.RGBToHSL(b.rgb);b.updateDisplay()}return this};b.setHSL=function(a){b.hsl=a;b.rgb=b.HSLToRGB(a);b.color=b.pack(b.rgb);b.updateDisplay();return this};b.widgetCoords=function(a){var c,d,h=a.target||a.srcElement,e=b.wheel;if(typeof a.offsetX!="undefined"){var f={x:a.offsetX,y:a.offsetY};for(a=h;a;){a.mouseX=f.x;a.mouseY=f.y;f.x+=a.offsetLeft;f.y+=a.offsetTop;a=a.offsetParent}a=
e;for(e={x:0,y:0};a;){if(typeof a.mouseX!="undefined"){c=a.mouseX-e.x;d=a.mouseY-e.y;break}e.x+=a.offsetLeft;e.y+=a.offsetTop;a=a.offsetParent}for(a=h;a;){a.mouseX=undefined;a.mouseY=undefined;a=a.offsetParent}}else{f=b.absolutePosition(e);c=(a.pageX||0*(a.clientX+$("html").get(0).scrollLeft))-f.x;d=(a.pageY||0*(a.clientY+$("html").get(0).scrollTop))-f.y}return{x:c-b.width/2,y:d-b.width/2}};b.mousedown=function(a){if(!document.dragging){$(document).bind("mousemove",b.mousemove).bind("mouseup",b.mouseup);
document.dragging=true}var c=b.widgetCoords(a);b.circleDrag=Math.max(Math.abs(c.x),Math.abs(c.y))*2>b.square;b.mousemove(a);return false};b.mousemove=function(a){var c=b.widgetCoords(a);if(b.circleDrag){a=Math.atan2(c.x,-c.y)/6.28;if(a<0)a+=1;b.setHSL([a,b.hsl[1],b.hsl[2]])}else{a=Math.max(0,Math.min(1,-(c.x/b.square)+0.5));c=Math.max(0,Math.min(1,-(c.y/b.square)+0.5));b.setHSL([b.hsl[0],a,c])}return false};b.mouseup=function(){$(document).unbind("mousemove",b.mousemove);$(document).unbind("mouseup",
b.mouseup);document.dragging=false};b.updateDisplay=function(){var a=b.hsl[0]*6.28;$(".h-marker",k).css({left:Math.round(Math.sin(a)*b.radius+b.width/2)+"px",top:Math.round(-Math.cos(a)*b.radius+b.width/2)+"px"});$(".sl-marker",k).css({left:Math.round(b.square*(0.5-b.hsl[1])+b.width/2)+"px",top:Math.round(b.square*(0.5-b.hsl[2])+b.width/2)+"px"});$(".color",k).css("backgroundColor",b.pack(b.HSLToRGB([b.hsl[0],1,0.5])));if(typeof b.callback=="object"){$(b.callback).css({backgroundColor:b.color,color:b.hsl[2]>
0.5?"#000":"#fff"});$(b.callback).each(function(){if(this.value&&this.value!=b.color)this.value=b.color})}else typeof b.callback=="function"&&b.callback.call(b,b.color)};b.absolutePosition=function(a){var c={x:a.offsetLeft,y:a.offsetTop};if(a.offsetParent){a=b.absolutePosition(a.offsetParent);c.x+=a.x;c.y+=a.y}return c};b.pack=function(a){var c=Math.round(a[0]*255),d=Math.round(a[1]*255);a=Math.round(a[2]*255);return"#"+(c<16?"0":"")+c.toString(16)+(d<16?"0":"")+d.toString(16)+(a<16?"0":"")+a.toString(16)};
b.unpack=function(a){if(a.length==7)return[parseInt("0x"+a.substring(1,3))/255,parseInt("0x"+a.substring(3,5))/255,parseInt("0x"+a.substring(5,7))/255];else if(a.length==4)return[parseInt("0x"+a.substring(1,2))/15,parseInt("0x"+a.substring(2,3))/15,parseInt("0x"+a.substring(3,4))/15]};b.HSLToRGB=function(a){var c,d=a[0];c=a[1];a=a[2];c=a<=0.5?a*(c+1):a+c-a*c;a=a*2-c;return[this.hueToRGB(a,c,d+0.33333),this.hueToRGB(a,c,d),this.hueToRGB(a,c,d-0.33333)]};b.hueToRGB=function(a,c,d){d=d<0?d+1:d>1?d-1:
d;if(d*6<1)return a+(c-a)*d*6;if(d*2<1)return c;if(d*3<2)return a+(c-a)*(0.66666-d)*6;return a};b.RGBToHSL=function(a){var c,d,h,e,f=a[0],i=a[1],j=a[2];c=Math.min(f,Math.min(i,j));a=Math.max(f,Math.max(i,j));d=a-c;e=(c+a)/2;h=0;if(e>0&&e<1)h=d/(e<0.5?2*e:2-2*e);c=0;if(d>0){if(a==f&&a!=i)c+=(i-j)/d;if(a==i&&a!=j)c+=2+(j-f)/d;if(a==j&&a!=f)c+=4+(f-i)/d;c/=6}return[c,h,e]};$("*",k).mousedown(b.mousedown);b.setColor("#000000");l&&b.linkTo(l)};
